# From https://cwiki.apache.org/confluence/display/HTTPD/Minimal+Config
ServerRoot "/usr/local/apache2"
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module modules/mod_dir.so
LoadModule headers_module modules/mod_headers.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule mime_module modules/mod_mime.so
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule unixd_module modules/mod_unixd.so

DocumentRoot "/usr/local/apache2/htdocs"
LogLevel warn
#ErrorLog logs/error_log
ErrorLog /proc/self/fd/2
#Listen 443
Listen *:443
ServerAdmin ${APACHE_SERVER_ADMIN}
ServerName ${APACHE_SERVER_NAME}
#SSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES
#SSLHonorCipherOrder on
#SSLPassPhraseDialog builtin
#SSLProtocol all -SSLv3
#SSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES
#SSLProxyProtocol all -SSLv3
#SSLSessionCache "shmcb:/usr/local/apache2/logs/ssl_scache(512000)"
#SSLSessionCacheTimeout 300

<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>
<IfModule headers_module>
    RequestHeader unset Proxy early
</IfModule>
<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    CustomLog /proc/self/fd/1 common
</IfModule>
<IfModule mime_module>
    TypesConfig conf/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
</IfModule>
<IfModule ssl_module>
	SSLRandomSeed startup builtin
	SSLRandomSeed connect builtin
</IfModule>
<IfModule unixd_module>
	User daemon
	Group daemon
</IfModule>

<Directory />
	AllowOverride None
	Require all denied
</Directory>
<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

<Files ".ht*">
    Require all denied
</Files>

<VirtualHost *:443>
	BrowserMatch "MSIE [2-5]" \
		nokeepalive ssl-unclean-shutdown \
		downgrade-1.0 force-response-1.0
	CustomLog /proc/self/fd/1 \
		"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"

	ProxyPreserveHost On
	ProxyPass / http://application/
	ProxyPassReverse / http://application/

	##ServerName www.example.com:443
	SSLCertificateFile "/usr/local/apache2/conf/server.crt"
	SSLCertificateKeyFile "/usr/local/apache2/conf/server.key"
	SSLEngine on
	SSLVerifyClient none
	TransferLog /proc/self/fd/1
	
	<Directory "/usr/local/apache2/cgi-bin">
		SSLOptions +StdEnvVars
	</Directory>
	<FilesMatch "\.(cgi|shtml|phtml|php)$">
		SSLOptions +StdEnvVars
	</FilesMatch>
	<Location "/Home/Certificate">
		SSLVerifyClient require
		SSLVerifyDepth 1
	</Location>
</VirtualHost>